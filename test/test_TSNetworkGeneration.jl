include("../TSNetworkGeneration.jl")

function test_fire_factory()

	fc = build_fire_models("data/raw/big_fire", 3, 10, 14)
	@assert all.(
		fc[1].wide_arcs[:, 1000:1002] ==
		[-1 -1 -1; 138 138 138; 4 4 4; 5 5 5; 122 123 125; 2 1 0]
	)
	@assert all.(
		fc[3].wide_arcs[:, 100:102] ==
		[-1 -1 -1; 25 26 26; 3 3 3; 4 4 4; 31 31 32; 0 2 0]
	)
	@assert size(fc[1].wide_arcs) == (6, 6407)
	@assert all.(
		fc[1].arc_costs[400:401] == [124623.11557788946, 126633.16582914571]
	)
	@assert all.(
		fc[2].state_in_arcs[1, :] == [
			Int64[],
			Int64[],
			Int64[],
			Int64[],
			[
				508,
				510,
				513,
				516,
				520,
				524,
				529,
				535,
				541,
				548,
				555,
				563,
				572,
				581,
				591,
				601,
			],
			[
				986,
				987,
				989,
				992,
				995,
				999,
				1003,
				1008,
				1014,
				1020,
				1027,
				1034,
				1042,
				1051,
				1060,
				1070,
				1080,
			],
			[
				1465,
				1466,
				1468,
				1471,
				1474,
				1478,
				1482,
				1487,
				1493,
				1499,
				1506,
				1513,
				1521,
				1530,
				1539,
				1549,
				1559,
			],
			[
				1944,
				1945,
				1947,
				1950,
				1953,
				1957,
				1961,
				1966,
				1972,
				1978,
				1985,
				1992,
				2000,
				2009,
				2018,
				2028,
				2038,
			],
			[
				2423,
				2424,
				2426,
				2429,
				2432,
				2436,
				2440,
				2445,
				2451,
				2457,
				2464,
				2471,
				2479,
				2488,
				2497,
				2507,
				2517,
			],
			[
				2902,
				2903,
				2905,
				2908,
				2911,
				2915,
				2919,
				2924,
				2930,
				2936,
				2943,
				2950,
				2958,
				2967,
				2976,
				2986,
				2996,
			],
			[
				3381,
				3382,
				3384,
				3387,
				3391,
				3396,
				3401,
				3407,
				3414,
				3422,
				3431,
				3440,
				3450,
			],
			[
				3879,
				3880,
				3882,
				3885,
				3889,
				3894,
				3899,
				3905,
				3912,
				3920,
				3929,
				3938,
				3948,
			],
			[
				4563,
				4564,
				4566,
				4569,
				4573,
				4578,
				4583,
				4589,
				4596,
				4604,
				4613,
				4622,
				4632,
			],
			[
				5268,
				5269,
				5271,
				5274,
				5278,
				5283,
				5288,
				5294,
				5301,
				5309,
				5318,
				5327,
				5337,
			],
			[
				5983,
				5984,
				5986,
				5989,
				5993,
				5998,
				6003,
				6009,
				6016,
				6024,
				6033,
				6042,
				6052,
			],
		]
	)
	println("passed test fire factory")
end

function test_crew_factory()

	fc = build_crew_models("data/raw/big_fire", 3, 10, 14)
	@assert all.(fc[1].wide_arcs[:, 10] == [10, 1, 1, 1, 1, 1, 2, 0, 0])
	@assert all.(fc[2].wide_arcs[:, 10] == [10, 1, 1, 1, 1, 1, 2, 0, 0])
	@assert all.(
		fc[1].arc_costs[400:420] == [
			1.0000000325233711e10,
			200.0,
			200.0,
			200.0,
			200.0,
			200.0,
			200.0,
			200.0,
			200.0,
			1.00000002e10,
			1.00000002e10,
			475.06851918064973,
			475.06851918064973,
			475.06851918064973,
			475.06851918064973,
			475.06851918064973,
			475.06851918064973,
			475.06851918064973,
			475.06851918064973,
			1.000000047506852e10,
			1.000000047506852e10,
		],
	)
	@assert sum(fc[7].wide_arcs) == 143856
	@assert sum(fc[5].long_arcs) == 143856
	@assert all.(
		fc[2].state_in_arcs[1, :, 1] == [
			[3380],
			[2, 12, 22, 2540],
			[92, 102, 112, 2570],
			[182, 192, 202, 2600],
			[272, 282, 292, 2630],
			[362, 372, 382, 2660],
			[452, 462, 472, 2690],
			[542, 552, 562, 2720],
			[632, 642, 652, 2750],
			[722, 732, 742, 2780],
			[812, 822, 832, 2810],
			[902, 912, 922, 2840],
			[992, 1002, 1012, 2870],
			[1082, 1092, 1102, 2900],
		]
	)

	println("passed test crew factory")

end

test_fire_factory()
test_crew_factory()